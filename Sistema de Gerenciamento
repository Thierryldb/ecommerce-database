package ecommerce;

import java.util.List;
import java.util.Scanner;

public class SistemaGerenciamento {

    private static Estoque estoque = new Estoque();
    private static Scanner scan = new Scanner(System.in);

    public static void main(String[] args) {
        System.out.println("--- Sistema de Controle de Armazém (Conectado ao MySQL) ---");

        boolean executando = true;
        while (executando) {
            exibirMenu();
            int opcao = lerOpcao();

            switch (opcao) {
                case 1:
                    cadastrarProduto();
                    break;
                case 2:
                    listarTodosProdutos();
                    break;
                case 3:
                    atualizarEstoqueProduto();
                    break;
                case 4:
                    menuPesquisarProduto();
                    break;
                case 5:
                    menuOrdenarProduto();
                    break;
                case 0:
                    executando = false;
                    System.out.println("Saindo do sistema. Até logo!");
                    break;
                default:
                    System.out.println("Opção inválida. Tente novamente.");
            }

            if (executando) {
                pressionarEnterParaContinuar();
            }
        }

        scan.close();
    }

    private static void exibirMenu() {
        System.out.println("\n--- MENU PRINCIPAL ---");
        System.out.println("1: Cadastrar novo produto");
        System.out.println("2: Listar todos os produtos");
        System.out.println("3: Atualizar estoque (quantidade)");
        System.out.println("4: Pesquisar produto");
        System.out.println("5: Ordenar e listar");
        System.out.println("0: Sair");
        System.out.print("Escolha uma opção: ");
    }

    private static int lerOpcao() {
        try {
            String entrada = scan.nextLine();
            if (entrada.trim().isEmpty()) return -1;
            return Integer.parseInt(entrada);
        } catch (NumberFormatException e) {
            return -1;
        }
    }

    // --- MÉTODOS QUE FALTAVAM ---

    private static void cadastrarProduto() {
        System.out.println("\n--- Cadastro de Produto ---");
        try {
            System.out.print("Código (ex: SKU123): ");
            String codigo = scan.nextLine();

            System.out.print("Nome: ");
            String nome = scan.nextLine();

            System.out.print("Categoria: ");
            String categoria = scan.nextLine();

            System.out.print("Preço (ex: 50.00): ");
            double preco = Double.parseDouble(scan.nextLine());

            System.out.print("Quantidade: ");
            int quantidade = Integer.parseInt(scan.nextLine());

            System.out.print("Avaliação (0.0 - 5.0): ");
            double avaliacao = Double.parseDouble(scan.nextLine());

            System.out.print("Popularidade (Vendas): ");
            int popularidade = Integer.parseInt(scan.nextLine());

            Produto novoProduto = new Produto(codigo, nome, categoria, preco, quantidade, avaliacao, popularidade);
            estoque.adicionarProduto(novoProduto);

        } catch (NumberFormatException e) {
            System.out.println("Erro: Certifique-se de digitar números válidos para preço, quantidade, etc.");
        }
    }

    private static void listarTodosProdutos() {
        List<Produto> todos = estoque.getTodosProdutos();
        exibirLista(todos, "Lista Completa");
    }

    private static void atualizarEstoqueProduto() {
        System.out.println("\n--- Atualizar Estoque ---");
        System.out.print("Digite o Código do produto: ");
        String codigo = scan.nextLine();

        try {
            System.out.print("Nova quantidade: ");
            int novaQtd = Integer.parseInt(scan.nextLine());
            estoque.atualizarQuantidade(codigo, novaQtd);
        } catch (NumberFormatException e) {
            System.out.println("Erro: Digite um número inteiro.");
        }
    }

    private static void menuPesquisarProduto() {
        System.out.println("\n--- Pesquisar ---");
        System.out.println("1: Por Código");
        System.out.println("2: Por Nome");
        System.out.println("3: Por Categoria");
        System.out.print("Opção: ");
        
        int op = lerOpcao();
        String termo;

        switch (op) {
            case 1:
                System.out.print("Digite o código: ");
                termo = scan.nextLine();
                Produto p = estoque.buscarPorCodigo(termo);
                if (p != null) System.out.println("Encontrado: " + p);
                else System.out.println("Não encontrado.");
                break;
            case 2:
                System.out.print("Digite parte do nome: ");
                termo = scan.nextLine();
                exibirLista(estoque.buscarPorNome(termo), "Busca por Nome");
                break;
            case 3:
                System.out.print("Digite a categoria: ");
                termo = scan.nextLine();
                exibirLista(estoque.buscarPorCategoria(termo), "Busca por Categoria");
                break;
            default:
                System.out.println("Opção inválida.");
        }
    }

    private static void menuOrdenarProduto() {
        System.out.println("\n--- Ordenar ---");
        System.out.println("1: Popularidade");
        System.out.println("2: Quantidade");
        System.out.println("3: Preço");
        System.out.println("4: Avaliação");
        System.out.print("Critério: ");

        int op = lerOpcao();
        String criterio = "";
        
        switch(op) {
            case 1: criterio = "popularidade"; break;
            case 2: criterio = "quantidade"; break;
            case 3: criterio = "preco"; break;
            case 4: criterio = "avaliacao"; break;
            default: System.out.println("Inválido"); return;
        }
        
        exibirLista(estoque.getProdutosOrdenados(criterio), "Ordenado por " + criterio);
    }

    // --- Utilitários ---

    private static void exibirLista(List<Produto> lista, String titulo) {
        System.out.println("\n--- " + titulo + " ---");
        if (lista.isEmpty()) {
            System.out.println("Nenhum registro encontrado.");
        } else {
            for (Produto p : lista) {
                System.out.println(p);
            }
        }
    }

    private static void pressionarEnterParaContinuar() {
        System.out.println("\n[Pressione ENTER para continuar...]");
        scan.nextLine();
    }
}
